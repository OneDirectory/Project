<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="">
<meta name="author" content="">


<!-- Bootstrap Core CSS -->
<link href="Resources/css/bootstrap1.min.css" rel="stylesheet">
<!-- Custom CSS -->
<link href="Resources/css/simple-sidebar.css" rel="stylesheet">
<link href="Resources/css/ProjectStyleSheet.css" rel="stylesheet">
</head>

<body>
<body class="adminPage">
	<div class="page-header">
		<br>
		<h2>
			Group one - One Directory <small>Project</small>
		</h2>
		<h2>Network Management Engineer Page</h2>
	</div>

	<div id="wrapper">
		<!-- Sidebar -->
		<div id="sidebar-wrapper">
			<ul class="sidebar-nav">
				<li class="sidebar-brand"><a href="#"> Menu </a></li>
				<li><a href="#">About</a></li>
				<li><a href="#">Affected IMSI with Count</a></li>
				<li><a href="index.html">Log out</a></li>
			</ul>
			<br>
		</div>
		<!-- /#sidebar-wrapper -->

		<!-- Page Content -->
		<div id="page-content-wrapper">
			<div class="container-fluid">
				<div class="row">
					<div class="col-lg-12">
						<h1>Total number of failures per IMSI</h1>

						<label class="control-label col-sm-2" for="ID">FROM:</label><br>

						<div>
							<input type="datetime-local" id='from' class="form-control"
								name="from" placeholder="dd-mm-yyyy hh:mm" autofocus>
						</div>

						<label class="control-label col-sm-2" for="ID">TO:</label>

						<div>
							<input type="datetime-local" id='to' class="form-control"
								name="to" placeholder="dd-mm-yyyy hh:mm" autofocus>
						</div>



						<div class="col-sm-offset-4 col-sm-10">
							<br>
							<button id="submit" type="submit" class="btn btn-primary">Search</button>
						</div>


					</div>
				</div>
			</div>
		</div>
		<!-- /#page-content-wrapper -->

	</div>
	<!-- /#wrapper -->

	<table class="table" id='table' name='table'>


	</table>


	<!-- jQuery -->
	<script src="Resources/js/jquery-1.6.1.min.js"></script>

	<!-- Bootstrap Core JavaScript -->
	<script src="Resources/js/bootstrap.min.js"></script>

	<!-- Menu Toggle Script -->
	<script>
	
    $("#menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("toggled");
    });
    
    </script>

	<script>
			var $table = $('#table');

 	$(function(){

 		$( "#submit" ).click(function(e) {

 	 		
 	removeData();	
	var fromDate=$('#from').val();
	var toDate=$('#to').val();
	var myurl;
	var isValid=false;
	
	if(validateEntry(fromDate, toDate)){	
		myurl='http://localhost:8080/Project-0.0.1-SNAPSHOT/rest/failedcalldata/count/'+fromDate+'Â£'+toDate;
		isValid=true;
		}

	else{
		myurl= 'http://localhost:8080/Project-0.0.1-SNAPSHOT/NMEPage.html';
		isValid=false;
		}

 	$.ajax({
 		type: 'GET',
 		url: myurl,
 		success: function(data){
 	 	
 	 		if(isValid && data.length>0){
 	 			createTable();
 	 			createButton();
 	 			$.each(data, function(key, value){
 	 				$table.append('<tr><td>'+value[0]+'</td><td>'+value[1]+'</td></tr>');
 	 	 			});
	 	 			isValid=false;
 	 	 		}
 	 		else if(isValid && data.length===0){
				alert('No available data for selected dates');
 	 	 		}
 			}

 		});
 	});
 	});

	function validateEntry(from, to){
		if(from===''){
			alert('Invalid FROM DateTime');
			return false;
		}
		else if(to===''){
			alert('Invalid TO DateTime');
			return false;
		}
		else if(isFromGtrTo(from, to)){
			alert('FROM date id greater than TO date');
			return false;
		}
		
		else
			return true;
	}

	function isFromGtrTo(from, to){
			
			var date1 = new Date(from);
			var date2 = new Date(to);
			
			if(date2.getTime()<=date1.getTime())
				return true;
			else
				return false;
	}

	
 	function createTable(){
 		
 		var row=document.createElement('tr');
 		row.setAttribute('id', 'head');
 		var colOne=document.createElement('th');
 		var colTwo=document.createElement('th');

 		colOne.innerHTML='IMSI';
 		colTwo.innerHTML='Number Of Failures';

 		row.appendChild(colOne);
 		row.appendChild(colTwo);

 		$table.append(row);
 		
 	}

 	function createButton(){
 		var butDiv=document.createElement('div');
 		butDiv.setAttribute('class', "col-sm-offset-12 col-sm-10");
 		var button=document.createElement(button);
 		button.setAttribute('id', 'tableButton');
 		button.setAttribute('class','btn btn-primary');
 		button.innerHTML='Search Again';
 		button.addEventListener('click', removeData);
 		butDiv.appendChild(button);
 		$table.append(butDiv);
 		
 	}

 	function removeData(){
 		var removeHead=document.getElementById('head');
 		var removeButton=document.getElementById('tableButton');
 		$table.empty();
 		
 	}
 	 	

	</script>
</body>

</html>
